# Эксперименты с to do list на Django
В учебных целях реализован бэкэнд (Django-DRF) для элементарного управления задачами.
#### Custom User Model
Используется кастомная модель пользователя на основе Django's AbstractUser. Основные изменения и настройки описаны ниже:

**Особенности**

* Email как основной идентификатор:
* В этой модели поле username не используется. Вместо этого в качестве основного идентификатора пользователя используется email.
* Поле email должно быть уникальным.
* phone: Дополнительное поле, которое может быть использовано для хранения номера телефона пользователя. Поле уникальное, но не является обязательным.

#### Models
Используются три основные модели для управления задачами, комментариями и тегами: Task, Comment и Tag. Ниже приводится описание каждой модели и их ключевые особенности.

**Task Model**

Модель Task представляет собой задачу, которую может создать пользователь.

Поля:
* owner: Владелец задачи, который связан с пользователем через ForeignKey. Может быть null или пустым.
* title: Заголовок задачи. Обязательное поле с максимальной длиной 200 символов.
* author: Автор задачи. Необязательное поле с максимальной длиной 25 символов.
* completed: Флаг, указывающий на завершенность задачи. По умолчанию значение False.
* tags: Поле ManyToMany, связывающее задачу с тегами, что позволяет задаче иметь несколько тегов.
* deadline: Дата и время выполнения задачи. Необязательное поле.
* description: Описание задачи. Необязательное текстовое поле.

**Comment Model**

Модель Comment используется для добавления комментариев к задачам.

Поля:
* task: Задача, к которой привязан комментарий. Связь через ForeignKey с моделью Task.
* text: Текст комментария.
* created_at: Дата и время создания комментария. Устанавливается автоматически при создании записи.

**Tag Model**
Модель Tag используется для создания тегов, которые могут быть связаны с задачами.

Поля:
* name: Название тега. Уникальное и обязательное поле с максимальной длиной 50 символов.

**Взаимодействие моделей**

* Каждая задача (Task) может иметь несколько тегов (Tag) через отношение ManyToMany.
* Комментарии (Comment) привязаны к задачам через отношение ForeignKey, что позволяет легко группировать комментарии по задачам.

#### Текущее состояние
Документация доступна на /swagger/ - автоматически сгенерирована через drf_yasg, для тестирования необходима авторизация. 

Авторизация возможна через JWT-токен, для этого предусмотрены эндпоинты:

    /api/register/ - {"email": "user@example.com", "password": "string"}
    Регистрация пользователя

    /api/token/ - {"email": "user@example.com", "password": "string"}
    Получениу Access и Refresh токенов по данным для авторизации

    /api/refresh/ - {"refresh": "string"}
    Получение Access токена по Refresh токену

Для работы с задачами предусмотрены:

    /api/tasks/create/
    /api/tasks/
    /api/tasks/<int:pk>/
    /api/tasks/<int:pk>/update/
    /api/tasks/<int:pk>/delete/

    /api/comments/create/
    /api/comments/
    /api/comments/<int:pk>/
    /api/comments/<int:pk>/update/
    /api/comments/<int:pk}/delete/

    /api/tags/create/
    /api/tags/
    /api/tags/<int:pk>/
    /api/tags/<int:pk>/update/
    /api/tags/<int:pk>/delete/

    Возможные параметры для методов можно увидеть в документации:
     /swagger/ - swagger с автодокументацией и возможностью тестирования (при наличии авторизации)
     /swagger.json - схема в json

##### Ключевые моменты

* Эндпоинты доступны при передаче JWT в заголовке запроса: Bearer + "access token"


* Настроено кеширование с использованием Redis.
* Закеширован контроллер работы со списком тегов, добавлена функция кеша для списка тегов в задачах.


* Настроен Celery с Redis в качестве брокера сообщений.
* Написана задача для проверки комментариев на запрещенные слова
* Написана задача для проверки дедлайна и обновления его на сегодня (установлено выполнение раз в 5 минут, может быть запущена вручную GET запросом на /check_deadlines/)


* Написаны Unit-тесты в для приложения todolist в todolist/tests.py
* И тест интеграции - корректность добавления комментария и тега к задаче
* Тесты можно запустить: python manage.py test


* Настройки указаны через переменные окружения и задаются в файле .env
* Пример файла - .env.sample

#### Запуск
1. Установить зависимости из requirements.txt
2. Прописать настройки доступа к БД, Redis и Celery файле .env в корне (образец в .env.sample)
3. Выполнить миграции
3. Запуск: `python todolist_core/manage.py runserver`
4. Celery: `celery -A conf worker --pool=threads --loglevel=info`
4. Celery-beat: `celery -A conf beat --loglevel=info`
5. Flower: `celery -A conf flower`

/admin/ - админ панель Django
